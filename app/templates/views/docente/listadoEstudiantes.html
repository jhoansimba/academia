{% include "views/default/header.html" %}
<!-- FontAwesome 5.15.3 CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />

<!-- (Optional) Use CSS or JS implementation -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js" integrity="sha512-RXf+QSDCUQs5uwRKaDoXt55jygZZm2V++WUZduaU/Ui/9EGp3f/2KZVahFZBKGH0s774sd3HmrhUy+SgOFQLVQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<div class="card">
  <div class="card-header"><h3>{{name}} del Paralelo <b>{{paralelo}}</b> </h3></div>
  <div class="card-body table-responsive ">
    
   
   <div class="alert ">
      <div id="errores">

      </div>
   </div>
   
    
    <table class="table" style="text-align: center">
      <thead>
        <tr>
          <th>Listado de estudiantes</th>
          <th colspan="9">Notas pertenecientes al nivel {{nivel}} de {{prog.0 | upper}} </th>
          <th colspan="3">Nota General</th>
          <th></th>
        </tr>
        <tr>
          <th></th>
          <th colspan="3">Parcial 1</th>
          <th colspan="3" style="border-left: 1px solid rgb(222,226, 230);">Parcial 2</th>
          <th colspan="3" style="border-left: 1px solid rgb(222,226, 230);">Parcial 3</th>
          <th style="border-left: 1px solid rgb(222,226, 230);">Sumatoria</th>
          <th style="border-left: 1px solid rgb(222,226, 230);">Promedio</th>
          <th style="border-left: 1px solid rgb(222,226, 230);">Actualizar</th>
          <th style="border-left: 1px solid rgb(222,226, 230);">Estado</th>
        </tr>
        {% for items in Estudiantes %}
        <form action="" method="POST"
          id="{% if items.notas.id %}{{items.notas.id}}{%else%}{{items.notas.code}}{% endif %}">
          {% csrf_token %}
          <!-- Ingreso de notas -->
          <tr>
            <th style="border-right: 1px solid rgb(222,226, 230);">{{items.notas.est}}
              <input type="hidden" value="{{items.notas.estudiante}}" name="estudiante">
              <input type="hidden" name='niveles' value="{{nivel}}">
              <input type="hidden" name='materia' value="{{programa}}">
              <input type="hidden" name='parcial' value="1">
              <!-- <input type="hidden" name='id' value="{{items.notas.id}}"> -->

            </th>

            <th style="border-right: 1px solid rgb(222,226, 230);"><input type="text"
                style="width: 70px;text-align: center; font-size: 11px;" value="{{items.notas.p_nota1|lower}}"
                name="p_nota1" class="form-control" required></th>
            <th style="border-right: 1px solid rgb(222,226, 230);"><input type="text"
                style="width: 70px;text-align: center; font-size: 11px;" value="{{items.notas.p_nota2|lower}}"
                name="p_nota2" class="form-control" required></th>
            <th style="border-right: 1px solid rgb(222,226, 230);"><input type="text"
                style="width: 70px;text-align: center; font-size: 11px;" value="{{items.notas.p_nota3|lower}}"
                name="p_nota3" class="form-control" required></th>
            <input type="hidden" name='parcial2' value="1">
            <th style="border-right: 1px solid rgb(222,226, 230);"><input type="text"
                style="width: 70px;text-align: center; font-size: 11px;" value="{{items.notas.s_nota1|lower}}"
                name="s_nota1" class="form-control" required></th>
            <th style="border-right: 1px solid rgb(222,226, 230);"><input type="text"
                style="width: 70px;text-align: center; font-size: 11px;" value="{{items.notas.s_nota2|lower}}"
                name="s_nota2" class="form-control" required></th>
            <th style="border-right: 1px solid rgb(222,226, 230);"><input type="text"
                style="width: 70px;text-align: center; font-size: 11px;" value="{{items.notas.s_nota3|lower}}"
                name="s_nota3" class="form-control" required></th>
            <input type="hidden" name='parcial3' value="1">
            <th style="border-right: 1px solid rgb(222,226, 230);"><input type="text"
                style="width: 70px;text-align: center; font-size: 11px;" value="{{items.notas.t_nota1|lower}}"
                name="t_nota1" class="form-control" required></th>
            <th style="border-right: 1px solid rgb(222,226, 230);"><input type="text"
                style="width: 70px;text-align: center; font-size: 11px;" value="{{items.notas.t_nota2|lower}}"
                name="t_nota2" class="form-control" required></th>
            <th style="border-right: 1px solid rgb(222,226, 230);"><input type="text"
                style="width: 70px;text-align: center; font-size: 11px;" value="{{items.notas.t_nota3|lower}}"
                name="t_nota3" class="form-control" required></th>
            <th style="border-right: 1px solid rgb(222,226, 230);"><input type="text" disabled name="" id=""
                value="{{items.notas.suma|lower}}" style="width: 70px; font-size: 11px" class="form-control"></th>
            <th style="border-right: 1px solid rgb(222,226, 230);"><input type="text" disabled name="" id=""
                value="{{items.notas.promedio|lower}}" style="width: 70px; font-size: 11px" class="form-control"></th>
            <td>
              <a onclick="editar('{% if items.notas.id %}{{items.notas.id}}{%else%}{{items.notas.code}}{% endif %}')"
                type="submit" class="btn btn-outline-success">Actualizar</a>
              <!-- <input type="submit" value="Actualizar" class="btn btn-success" > -->
            </td>
            <td>
              {% if items.notas.estado %}
              <b style="color: green;">Si</b>
              {% else %}
              <b style="color: red;">No</b>
              {% endif %}
            </td>
          </tr>
        </form>
        {% endfor %}
      </thead>

    </table>

  </div>
  <div class="card-footer">
    <a href="asistencia" type="button" class="btn btn-success">asistencia</a>
    <a href="/docentes/programa/{{programa}}" type="button" class="btn btn-success">Regresar</a>
    <a onclick="saveAll('{{save}}', '{{code}}')" type="button" class="btn btn-warning">Guardar todo</a>

  </div>

  {% for i in matricula %}
  {% for j in i.asignacion.all %}
  <tr>
    <td>{{j}}</td>
    <td>{{i.inicio}}</td>
    <td>{{i.fin}}</td>
    <td>{{i.nivel}}</td>
  </tr>
  {% endfor %}
  {% endfor %}
  </tbody>
  </table>
</div>
<div class="row">
  {% for i in niveles %}
  <div class="col-xs|sm|md|lg|xl-1-12">
    <div class="card">
      <div class="card-body">
        <h3 class="card-title">Nivel {{i}} </h3>
        <!-- Orden Programa MAtricula/Curso IDPrograma / 040 -->
        <!-- docente/listado/matricula/1/idPOR/ -->
        <p class="card-text"><a href="matricula/{{i}}/{{Materia}}" type="button" class="btn btn-white">Ingresar a este
            nivel<a></p>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% include "views/default/footer.html" %}
<script>
  function editar(id) {
    if (id.length < 10) {
      let name = '#' + id;
      let url = 'edit/' + id
      let form = $(name).serializeArray();
      $.ajax({
        url: url,
        method: 'POST',
        data: form
      }).done((req) => {
        if (req.info) {
          location.reload()
        } else {
          alert('Error al guardar los datos')
          document.getElementById('errores').innerHTML = req.error;
        }
      })
    } else {
      addNotas(id);
    }

  }
  function addNotas(code) {
    let name = '#' + code;
    let form = $(name).serializeArray();
    $.ajax({
      url: 'add',
      method: 'POST',
      data: form
    }).done((req) => {
      if (req.info) {
        document.getElementById('errores').innerHTML = '';
        location.reload()

      } else {
        alert('Error al guardar los datos')
        document.getElementById('errores').innerHTML = req.error;
      }
    })

  }


  function saveAll(params, code) {
    let est = '{{Estudiantes}}';
    console.log('Valor : ', est.length);
    if (est.length > 2) {
      if (confirm('¿Está seguro de guardar todo?')) {
        if (params) {
          let datos = params.split(',')
          console.log(datos);
          for (let index = 0; index < (datos.length - 1); index++) {
            editar(datos[index]);
          }
        }
        if (code) {
          let datos = code.split(',')
          console.log(datos);
          for (let index = 0; index < (datos.length - 1); index++) {
            addNotas(datos[index]);
          }
        }
      } else {
        alert('Proceso cancelado...')
      }
    } else {
      alert('Sin datos que guardar...')
    }
  }
</script>